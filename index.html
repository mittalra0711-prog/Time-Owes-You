<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Time Owes You</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
<style>
body { margin:0; background:#0b1020; }
</style>
</head>
<body>

<script>
let timeLeft = 30;
let boost = false;
let boostTimer = 0;

const config = {
  type: Phaser.AUTO,
  width: window.innerWidth,
  height: window.innerHeight,
  backgroundColor: "#0b1020",
  physics: {
    default: "arcade",
    arcade: { debug:false }
  },
  scene: { preload, create, update }
};

new Phaser.Game(config);

let player, enemy, orb, timeText, joystick;

function preload() {}

function create() {
  this.cameras.main.setBackgroundColor("#0b1020");

  player = this.physics.add.circle(400,300,16,0x00ffff);
  enemy  = this.physics.add.circle(100,100,14,0xff3333);
  orb    = this.physics.add.circle(200,200,10,0x00ff00);

  player.body.setCollideWorldBounds(true);
  enemy.body.setCollideWorldBounds(true);

  timeText = this.add.text(20,20,"Time: 30",{fontSize:"20px",fill:"#fff"});

  // Simple joystick
  joystick = this.plugins.get('rexvirtualjoystickplugin')?.add(this,{
    x: 100,
    y: this.scale.height-100,
    radius: 60,
    base: this.add.circle(0,0,60,0x888888,0.2),
    thumb: this.add.circle(0,0,30,0xffffff,0.4),
  });

  // Fallback manual joystick
  this.input.on("pointermove", p=>{
    player.x = Phaser.Math.Clamp(p.x,0,this.scale.width);
    player.y = Phaser.Math.Clamp(p.y,0,this.scale.height);
  });

  this.physics.add.overlap(player, orb, ()=>{
    timeLeft += 10;
    orb.setPosition(
      Phaser.Math.Between(50,this.scale.width-50),
      Phaser.Math.Between(50,this.scale.height-50)
    );
  });

  this.physics.add.overlap(player, enemy, ()=>{
    timeLeft -= 7;
  });

  this.time.addEvent({
    delay:1000,
    loop:true,
    callback:()=>{
      timeLeft--;
      if(boost){
        boostTimer--;
        if(boostTimer<=0) boost=false;
      }
      timeText.setText("Time: "+timeLeft);
      if(timeLeft<=0){
        this.scene.restart();
        timeLeft=30;
      }
    }
  });
}

function update() {
  this.physics.moveToObject(enemy, player, 100);
}
</script>

</body>
</html>
